<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-NQL/Built-in filters">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Built-in filters | Sycope Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://documentation.sycope.com/NQL/Built-in filters"><meta data-rh="true" name="docusaurus_locale" content="en-GB"><meta data-rh="true" name="docsearch:language" content="en-GB"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Built-in filters | Sycope Documentation"><meta data-rh="true" name="description" content="Filters that have been built into the System are shown in the table below."><meta data-rh="true" property="og:description" content="Filters that have been built into the System are shown in the table below."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://documentation.sycope.com/NQL/Built-in filters"><link data-rh="true" rel="alternate" href="https://documentation.sycope.com/NQL/Built-in filters" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://documentation.sycope.com/NQL/Built-in filters" hreflang="x-default"><link rel="search" type="application/opensearchdescription+xml" title="Sycope Documentation" href="/opensearch.xml">
<link rel="stylesheet" href="/css/theme-dark.css" id="prime-theme">
<script src="/js/prime-theme.js"></script><link rel="stylesheet" href="/assets/css/styles.666559ab.css">
<link rel="preload" href="/assets/js/runtime~main.b97d06f8.js" as="script">
<link rel="preload" href="/assets/js/main.7f64acbd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-sycope.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-sycope.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">sycope documentation</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item"><p style="margin: 0 -12px; color: white">version:</p></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/">2.4</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/NQL/Built-in filters">2.4</a></li><li><a class="dropdown__link" href="/2.3/NQL/Built-in filters">2.3</a></li><li><a class="dropdown__link" href="/2.2.3/">2.2.3</a></li><li><a class="dropdown__link" href="/2.2.2/">2.2.2</a></li><li><a class="dropdown__link" href="/2.2.1/">2.2.1</a></li><li><a class="dropdown__link" href="/2.1.0/">2.1.0</a></li><li><a class="dropdown__link" href="/2.0.29/">2.0.29</a></li><li><a class="dropdown__link" href="/2.0.27/">2.0.27</a></li><li><a class="dropdown__link" href="/2.0/">2.0</a></li><li><a class="dropdown__link" href="/1.6/">1.6</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/User interface">User interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Installation guide">Installation guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/User Guide/">User Guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/NQL/NQL documentation">NQL</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/NQL/NQL documentation">NQL User Manual</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/NQL/nql_cheat_sheet">NQL CheatSheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/NQL/Built-in filters">Built-in filters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/NQL/NQL_examples">NQL query examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/NQL/Searchbar">Search bar</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Examples/">Examples</a><button aria-label="Toggle the collapsible sidebar category &#x27;Examples&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Release notes">Release notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Requirements">Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item hidden"><a class="menu__link" href="/Sycope_Probe">Sycope Probe User Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/3rdpartylicenses">3rd Party Licenses</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">NQL</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Built-in filters</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 2.4</span><div class="theme-doc-markdown markdown"><h1>Built-in filters</h1><p>Filters that have been built into the System are shown in the table below.</p><table><thead><tr><th>Name</th><th>Description</th><th>Source</th><th>Query</th></tr></thead><tbody><tr><td>Abnormal activity</td><td>The search allows for analyzing network traffic in 3-hour time periods in  context of countries, which may help to detect abnormal activities.</td><td>netflowByCountryAggr</td><td>set sumClientBytesAndServerBytes = add(clientBytes, serverBytes) <!-- -->|<!-- -->  timeAggr dcCountry=dc(country),  avgSumClientBytesAndServerBytes=avg(sumClientBytesAndServerBytes),sum1 =  sum(sumClientBytesAndServerBytes), countries=join(country),  mintimestamp=min(timestamp),maxtimestamp=max(timestamp) on timestamp  interval=&quot;3h&quot; <!-- -->|<!-- --> set  timestampStr=tsToStr(_bucket),mintimestampStr=tsToStr(mintimestamp),maxtimestampStr=tsToStr(maxtimestamp)  <!-- -->|<!-- --> project +avgSumClientBytesAndServerBytes as clientBytes, +countries as  country, +timestampStr as timestamp, +mintimestampStr as activeTime,  +maxtimestampStr as tenantId</td></tr><tr><td>Activity on non-standard ports</td><td>The search allows   for detecing suspicious ports <a href="https://attack.mitre.org/techniques/T1571/" target="_blank" rel="noopener noreferrer">(e.g. based on MITRE non-standard ports list)</a></td><td>netflow</td><td>lookupKeyExists(&quot;ports-suspicious&quot;,  {&quot;Port&quot;: serverPort} )</td></tr><tr><td>Bottom Client IPs</td><td>The search allows to display at least common client IP Addresses, which  help to identify potential bad hosts.</td><td>netflow</td><td>aggr countClientIp=count(clientIp) by clientIp unwind=true <!-- -->|<!-- --> sort  countClientIp asc <!-- -->|<!-- --> limit 10 <!-- -->|<!-- --> project +clientIp, +countClientIp as flows</td></tr><tr><td>Brute Force - SSH</td><td>The search allows for detection a brute force attack against  SSH services.</td><td>netflow</td><td>(serverPort=22 or applicationNameNtop=&quot;SSH&quot;) <!-- -->|<!-- --> aggr  _countSessions=count(timestamp), _sumBytes=sum(add(clientBytes,serverBytes)),  _sumPackets=sum(add(clientPackets,serverPackets)) by clientIp, serverIp,  serverPort unwind=true <!-- -->|<!-- --> sort _countSessions desc <!-- -->|<!-- --> _countSessions &gt; 50  and _sumBytes &gt; 1000 <!-- -->|<!-- --> project +clientIp,+serverIp,+_sumBytes as  clientBytes,+_countSessions as flows,+_sumPackets as  clientPackets,+serverPort</td></tr><tr><td>Chat</td><td>The search allows for detection chat traffic such as for example Signal,  QQ, IRC, WhatsApp, Telegram, KakaoTalk or WeChat.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;Signal&quot;,&quot;QQ&quot;,&quot;IRC&quot;,&quot;WhatsApp&quot;,&quot;Telegram&quot;,&quot;KakaoTalk&quot;,&quot;WeChat&quot;]</td></tr><tr><td>Cloud</td><td>The search allows for monitoring cloud traffic.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;NestLogSin&quot;,&quot;Dropbox&quot;,&quot;UbuntuONE&quot;,&quot;Microsoft&quot;,&quot;GoogleDrive&quot;,&quot;MS_OneDrive&quot;,&quot;LISP&quot;,&quot;ApplePush&quot;,&quot;AmazonVideo&quot;,&quot;AmazonAWS&quot;,&quot;Salesforce&quot;,&quot;Azure&quot;,&quot;GoogleCloud&quot;,&quot;Edgecast&quot;,&quot;Cachefly&quot;]</td></tr><tr><td>Collaborative</td><td>The search allows for monitoring collaborative applications, such as for  example Discord or Slack.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;Discord&quot;,&quot;Slack&quot;,&quot;LotusNotes&quot;,&quot;Github&quot;,&quot;Microsoft365&quot;,&quot;Git&quot;,&quot;GoogleDocs&quot;,&quot;Teams&quot;,&quot;GitLab&quot;,&quot;GoogleClassroom&quot;]</td></tr><tr><td>CTI Alerts</td><td>The search allows displaying alerts detected by Sycope CTI.</td><td>alerts</td><td>any(<!-- -->[&quot;CTI&quot;]<!-- -->, alertTags)</td></tr><tr><td>Dangerous system</td><td>The search allows for detection dangerous applications, such as  for example SBMv1.</td><td>netflow</td><td>applicationNameNtop in <!-- -->[&quot;SMBv1&quot;]</td></tr><tr><td>Dangerous VPN</td><td>The search allows for detecting network traffic regarding  dangerous VPN as Tor or HotspotShield.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;Tor&quot;,&quot;HotspotShield&quot;]</td></tr><tr><td>Data Transfer</td><td>The search allows for monitoring applications from the Data Transfer  category.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;NFS&quot;,&quot;TFTP&quot;,&quot;AFP&quot;,&quot;CHECKMK&quot;,&quot;RSYNC&quot;,&quot;Crashlytics&quot;]</td></tr><tr><td>Database</td><td>The search allows for monitoring DB traffic.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;MySQL&quot;,&quot;MongoDB&quot;,&quot;MsSQL-TDS&quot;,&quot;Oracle&quot;,&quot;Redis&quot;,&quot;DRDA&quot;,&quot;Cassandra&quot;]</td></tr><tr><td>DoS</td><td>The search allows for detecting denial of service attacks.</td><td>netflow</td><td>aggr countSessions=count(timestamp),  uniqueClientIPs=dc(clientIp), clientBytes=sum(clientBytes) by serverIp  unwind=true <!-- -->|<!-- --> sort countSessions desc <!-- -->|<!-- --> project +serverIp,+countSessions as  flows, +uniqueClientIPs as clientPackets, +clientBytes <!-- -->|<!-- --> clientPackets &gt;  200 and flows &gt; 10000 and clientBytes &gt;10000</td></tr><tr><td>Exfiltration over Web Service  (Cloud Storages)</td><td>The search allows for detecting data exfiltration via cloud  storages.</td><td>netflow</td><td>httpHost in  <!-- -->[&quot;dropbox.com&quot;,&quot;box.com&quot;,&quot;drive.google.com&quot;,&quot;mega.io&quot;,&quot;mediafire.com&quot;]</td></tr><tr><td>Exfiltration over Web Service  (Code Repositories)</td><td>The search allows for detecting data exfiltration via web code  repositories.</td><td>netflow</td><td>httpHost in  <!-- -->[&quot;github.com&quot;,&quot;justpaste.it&quot;,&quot;pastebin.com&quot;,&quot;onpaste.com&quot;,&quot;transfernow.net&quot;,&quot;codepad.org&quot;]</td></tr><tr><td>External Threats</td><td>The search allows displaying internal threats, that is, alerts where  either the client or the server has a public address.</td><td>alerts</td><td>(isIpPrivate(clientIp) and not isIpPrivate(serverIp)) or(not  isIpPrivate(clientIp) and isIpPrivate(serverIp))</td></tr><tr><td>Game</td><td>The search allows for monitoring traffic from the Game category.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;Xbox&quot;,&quot;AmongUs&quot;,&quot;Steam&quot;,&quot;HalfLife2&quot;,&quot;WorldOfWarcraft&quot;,&quot;Armagetron&quot;,&quot;Dofus&quot;,&quot;Fiesta&quot;,  &quot;Florensia&quot;,&quot;Guildwars&quot;,&quot;MapleStory&quot;,&quot;Warcraft3&quot;,&quot;WorldOfKungFu&quot;,&quot;Nintendo&quot;,&quot;Starcraft&quot;,&quot;Playstation&quot;,&quot;CSGO&quot;,&quot;GenshinImpact&quot;,&quot;Activision&quot;,&quot;RakNet&quot;]</td></tr><tr><td>Horizontal Scan</td><td>The search allows for detecting many connections/flows from one  host to many on the same port. Such activity may indicate on horizontal  scans.</td><td>netflow</td><td>$_INT$ <!-- -->|<!-- --> aggr _uniqueServerIps=dc(serverIp),  _countSessions=count(timestamp) by clientIp, serverPort unwind=true <!-- -->|<!-- --> sort  _uniqueServerIps desc <!-- -->|<!-- --> where _countSessions &gt; 100 and _uniqueServerIps  &gt; 30 <!-- -->|<!-- --> project +clientIp,+serverPort,+_countSessions as  flows,+_uniqueServerIps as clientPort</td></tr><tr><td>Internal Threats</td><td>The search allows displaying internal threats, that is, alerts where the  client and server IP addresses are private.</td><td>alerts</td><td>isIpPrivate(clientIp) and isIpPrivate(serverIp)</td></tr><tr><td>IoT-Scada</td><td>The search allows for monitoring IoT/OT traffic, such as Modbus, DNP3 or  IEC60870.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;Modbus&quot;,&quot;DNP3&quot;,&quot;IEC60870&quot;]</td></tr><tr><td>Large Google Cloud Upload</td><td>This search detects a large Google Drive upload traffic. Such  activity may indicate on policy violation or exfiltration attempt.</td><td>netflow</td><td>serverAsNumber = 15169 <!-- -->|<!-- --> aggr  sumBytes=sum(add(clientBytes,serverBytes)) by serverIp, clientIp unwind=true  <!-- -->|<!-- --> sort sumBytes desc <!-- -->|<!-- --> sumBytes &gt; 1000000 <!-- -->|<!-- --> project  +clientIp,+serverIp,+sumBytes as clientBytes</td></tr><tr><td>Malicious IoC</td><td>The search detects communications with malicious IoC (IPs and  Domains) &gt; 20kB.</td><td>netflow</td><td>lookupKeyExists(&quot;sec-cti-ip-malware&quot;,  {&quot;ip&quot;: clientIp} ) OR  lookupKeyExists(&quot;sec-cti-ip-malware&quot;, {&quot;ip&quot;: serverIp})  OR lookupKeyExists(&quot;sec-cti-domain-malware-db&quot;,  {&quot;domain&quot;: dnsQuery}) <!-- -->|<!-- --> set bytes=add(clientBytes, serverBytes) <!-- -->|<!-- -->  aggr bytes=sum(bytes) by clientIp,serverIp unwind=true <!-- -->|<!-- --> sort bytes desc <!-- -->|<!-- -->  bytes &gt; 20000 <!-- -->|<!-- --> project +clientIp,+serverIp,+bytes as clientBytes</td></tr><tr><td>Malicious IP/Host</td><td>The search allows for detection communication to/from malicious  IP addresses.</td><td>netflow</td><td>lookupKeyExists(&quot;sec-cti-ip-malware&quot;,  {&quot;ip&quot;: clientIp} ) OR  lookupKeyExists(&quot;sec-cti-ip-malware&quot;, {&quot;ip&quot;: serverIp})  OR lookupKeyExists(&quot;sec-cti-domain-malware-db&quot;,  {&quot;domain&quot;: dnsQuery})</td></tr><tr><td>Monitor unauthorized dynDNS  services</td><td>The search allows for detecting dynamic DNS services, which can  be used to host malicious payloads or C2 nodes to bypass firewalls and other  threat detection systems. There are many common dynamic DNS services, e.g.  123DDNS, AFRAID.ORG, CHANGEIP, ClouDNS, DNS Max, DNSEXIT, DNSMADEEASY,  DUCKDNS, DVRLISTS, DYIP, DYN, DYNDNSS, DYNS, DYNU, DYNV6, EASTERNDNS,  EASYDNS, EuroDynDNS, FREEDNS, LAVIEW, NO-IP, SECUREPOINT, SWANN, THATIP,  ULTRADNS, YDNS, ZONEEDIT. The created query is an example of searching for  only a few of them.</td><td>netflow</td><td>regex(dnsQuery,&quot;.<em>cloud.dns&quot;) or  regex(dnsQuery,&quot;.</em>dynu.net&quot;) or  regex(dnsQuery,&quot;.*mywire.org&quot;)</td></tr><tr><td>Multi-host threats</td><td>The search allows displaying multi-host threats, that is, alerts where  multiple hosts could participate as either client or server.</td><td>alerts</td><td>clientIp = null or serverIp = null</td></tr><tr><td>Potentially Dangerous Download</td><td>The search allows for monitoring potentially dangerous download  applications.</td><td>netflow</td><td>applicationNameNtop in <!-- -->[&quot;Pastebin&quot;]</td></tr><tr><td>Potentially Dangerous Network</td><td>The search allows for detection potentially dangerous network  traffic.</td><td>netflow</td><td>applicationNameNtop in <!-- -->[&quot;RemoteScan&quot;]</td></tr><tr><td>Remote Access Software</td><td>The search allows for detecting unathorized usage of Remote  Monitoring and Management software. Cybercriminals may use such software for  C2 activities, so as part of threat hunting, consider to analyze anomalies  related to such services as for example: 5938/tcp - Team Viewer 15000/udp -  Go2Assist 5631/tcp - PCAnywhere 5632/udp - PCAnywhere 5650/tcp - Remote  Utilities 5655/tcp - Remote Utilities remoteutilities.com - Remote Utilities  6568/tcp - AnyDesk</td><td>netflow</td><td>(protocol =&quot;6&quot; and serverPort in <!-- -->[5938, 6568, 5650,  5655, 5631]<!-- --> ) or (protocol = &quot;17&quot; and serverPort in <!-- -->[15000, 5632]<!-- -->)  or httpHost = &quot;remoteutilities.com&quot;</td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td>Resource Hijacking</td><td>The search detects crypto-mining activity based on  characteristics ports (3333, 3334, 3335, 4444, 5555, 5556, 6633, 6666, 7777,  8788, 8888, 8899, 9980, 9999, 13333, 14433, 14444, 16633, 16666).</td><td>netflow</td><td>lookupKeyExists(&quot;sec-port-cryptomining&quot;,  {&quot;Port&quot;: serverPort }) or  lookupKeyExists(&quot;sec-port-cryptomining&quot;, {&quot;Port&quot;:  clientPort })</td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td>Reverse Proxy - Ngrok</td><td>The search allows for detecting connections to a reverse proxy  tool - Ngrok. The tool can create a secure tunnel to servers behind firewalls  or on local computers that don&#x27;t have a public IP address. Ngrok has been  used by cybercrime groups in several campaigns, including lateral movement  and data exfiltration.</td><td>netflow</td><td>regex(httpSite,&quot;.<em>ngrok.</em>&quot;)</td></tr><tr><td>Social Networks</td><td>The search allows for monitoring social networks applications.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;TikTok&quot;,&quot;GooglePlus&quot;,&quot;Tumblr&quot;,&quot;Facebook&quot;,&quot;Twitter&quot;,&quot;Pinterest&quot;,&quot;Snapchat&quot;,&quot;Sina(Weibo)&quot;,&quot;Reddit&quot;,&quot;Instagram&quot;,&quot;LinkedIn&quot;,&quot;Likee&quot;,&quot;Badoo&quot;,&quot;Tencent&quot;]</td></tr><tr><td>Streaming</td><td>The search allows for monitoring streaming applications.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;PPStream&quot;,&quot;DisneyPlus&quot;,&quot;Hulu&quot;,&quot;AppleiTunes&quot;,&quot;Pandora&quot;,&quot;Vimeo&quot;,&quot;Dazn&quot;,&quot;1kxun&quot;]</td></tr><tr><td>Suspicious ASN</td><td>Analyzing of   communication to/from suspicious ASNs should be a part of the threat hunting   process. You can find a list of suspicious ASNs, e.g. on the   <a href="https://www.spamhaus.org/" target="_blank" rel="noopener noreferrer">https://www.spamhaus.org/ website.</a></td><td>netflow</td><td>clientAsNumber in <!-- -->[4134,4837,45609,36947,7713,14618, 24560,  23969 ,17557]<!-- --> or serverAsNumber in <!-- -->[4134,4837,45609,36947,7713,14618, 24560,  23969 ,17557]</td></tr><tr><td>Suspicious Country</td><td>Analyzing of   communication to/from suspispicious countries should be a part of the threat   hunting process. You can find a list of suspicious countries, e.g. on the  <a href="https://www.spamhaus.org/statistics/botnet-cc/" target="_blank" rel="noopener noreferrer">https://www.spamhaus.org/statistics/botnet-cc/ website.</a></td><td>netflow</td><td>clientCountry = &quot;CN&quot; or clientCountry=&quot;ID&quot;  or clientCountry=&quot;TH&quot;</td></tr><tr><td>Suspicious LDAP Activity</td><td>Cybercriminals may use LDAP protocol to malicious activities,  as for example in the Log4j vulnerability, so as a Threat Hunter consider to  analyze anomalies related to this protocol, e.g. connections to/from external  LDAP servers.</td><td>netflow</td><td>($INT_EXT$ or $EXT_INT$) AND (serverPort = 636 AND protocol =  6) OR (serverPort = 389 AND protocol = 17) <!-- -->|<!-- --> not  any(serverFunction,<!-- -->[&quot;LDAP&quot;]<!-- -->)</td></tr><tr><td>Suspicius host</td><td>A search allows for detection suspicious host based on unusual  network traffic characteristics.</td><td>netflow</td><td>aggr _countSessions=count(timestamp),  _sumPackets=sum(add(clientPackets,serverPackets)) by clientIp,serverIp  unwind=true <!-- -->|<!-- --> set _ppf=div(_sumPackets,_countSessions) <!-- -->|<!-- --> sort  _ppf,_countSessions desc <!-- -->|<!-- --> _ppf &gt;50 and _countSessions&gt;100 <!-- -->|<!-- --> project  +clientIp,+serverIp,+_ppf as clientPackets,+_countSessions as flows</td></tr><tr><td>Top Client IPs</td><td>A search allows to display most common client IP Addresses, which help to  identify potential abuses.</td><td>netflow</td><td>aggr countClientIp=count(clientIp) by clientIp unwind=true <!-- -->|<!-- --> sort  countClientIp desc <!-- -->|<!-- --> limit 10 <!-- -->|<!-- --> project +clientIp, +countClientIp as flows</td></tr><tr><td>Unauthorized SSH Activity  (External -&gt; Internal)</td><td>The search allows for detection unauthorized SSH traffic from  external to internal host.</td><td>netflow</td><td>$EXT_INT$ and serverPort = 22 AND not  any(serverFunction,<!-- -->[&quot;SSH&quot;]<!-- -->) <!-- -->|<!-- --> aggr  _sumBytes=sum(add(clientBytes,serverBytes)) by clientIp, serverIp, serverPort  unwind=true <!-- -->|<!-- --> sort _sumBytes desc <!-- -->|<!-- --> _sumBytes &gt; 1000 <!-- -->|<!-- -->  project +clientIp,  +serverIp, +_sumBytes as clientBytes, +serverPort</td></tr><tr><td>Unauthorized SSH Activity  (Internal -&gt; External)</td><td>The search allows for detection unauthorized SSH traffic from  internal to external host.</td><td>netflow</td><td>serverPort = 443 AND not any(serverFunction,<!-- -->[&quot;SSH&quot;]<!-- -->)  <!-- -->|<!-- --> aggr _sumBytes=sum(add(clientBytes,serverBytes)) by clientIp, serverIp,  serverPort unwind=true <!-- -->|<!-- --> sort _sumBytes desc <!-- -->|<!-- --> _sumBytes &gt; 1000 <!-- -->|<!-- --> project  +clientIp, +serverIp, +_sumBytes as clientBytes, +serverPort</td></tr><tr><td>Unauthorized SSH activity on  non-standard port</td><td>The search allows for detection SSH traffic on non-standard  ports.</td><td>netflow</td><td>applicationNameNtop = &quot;SSH&quot; and serverPort != 22 and  not any(serverFunction,<!-- -->[&quot;SSH&quot;]<!-- -->)</td></tr><tr><td>Vertical Scan</td><td>The search allows for detecting many connections/flows between  two hosts on many ports. Such activity may indicate on vertical scans.</td><td>netflow</td><td>$_INT$ <!-- -->|<!-- --> aggr _countUniqueServerPorts=dc(serverPort),  _countSessions=count(timestamp) by clientIp, serverIp unwind=true <!-- -->|<!-- --> sort  _countSessions desc, _countUniqueServerPorts desc <!-- -->|<!-- --> where  _countUniqueServerPorts &gt; 30 and _countSessions &gt; 200 <!-- -->|<!-- --> project  +clientIp,+serverIp,+_countSessions as flows,+_countUniqueServerPorts as  serverPort</td></tr><tr><td>Video</td><td>The search allows for monitoring video traffic.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;Zattoo&quot;,&quot;Sopcast&quot;,&quot;TVUplayer&quot;,&quot;QQLive&quot;,&quot;PS_VUE&quot;,&quot;NetFlix&quot;,&quot;Zoom&quot;,&quot;Twitch&quot;,&quot;IFLIX&quot;]</td></tr><tr><td>VirtAssistant</td><td>The search allows for detection virtual assistants.</td><td>netflow</td><td>applicationNameNtop in <!-- -->[&quot;AmazonAlexa&quot;,&quot;AppleSiri&quot;]</td></tr><tr><td>VoIP</td><td>The search allows for monitoring VoIP applications.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;SkypeCall&quot;,&quot;WhatsAppCall&quot;,&quot;MGCP&quot;,&quot;IAX&quot;,&quot;SIP&quot;,&quot;TruPhone&quot;,&quot;Skype_Teams&quot;,&quot;Webex&quot;,&quot;Viber&quot;,&quot;Tuenti&quot;,&quot;H323&quot;,&quot;NOE&quot;,&quot;TeamSpeak&quot;,&quot;CiscoSkinny&quot;,&quot;RTCP&quot;,&quot;Megaco&quot;,&quot;KakaoTalk_Voice&quot;,&quot;IMO&quot;,&quot;SnapchatCall&quot;,&quot;FacebookVoip&quot;,&quot;SignalVoip&quot;,&quot;Fuze&quot;,&quot;GoTo&quot;]</td></tr><tr><td>VPN</td><td>The search allows for monitoring VPN traffic.</td><td>netflow</td><td>applicationNameNtop in  <!-- -->[&quot;PTTP&quot;,&quot;OpenVPN&quot;,&quot;CiscoVPN&quot;,&quot;WireGuard&quot;,&quot;TINC&quot;,&quot;FortiClient&quot;,&quot;iCloudPrivateRelay&quot;,&quot;Softether&quot;]</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-07-31T08:39:38.000Z">31 Jul 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/NQL/nql_cheat_sheet"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">NQL CheatSheet</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/NQL/NQL_examples"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">NQL query examples</div></a></nav></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Sycope</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b97d06f8.js"></script>
<script src="/assets/js/main.7f64acbd.js"></script>
</body>
</html>